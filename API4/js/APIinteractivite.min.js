function finDS(){modeEbauche&&!dv.modeEbauche?correction():modeEbauche||confirm("Avez-vous vraiment terminé votre devoir ?")&&sendDS()}function sendDS(){try{window.clearInterval(runTimer)}catch(e){}"function"==typeof renew&&renew(),"function"==typeof beforeSave&&beforeSave();var t=document.getElementById("minute");$("#resteMinute").val(t.textContent),t=document.getElementById("seconde"),$("#resteSeconde").val(t.textContent),document.getElementById("correction").setAttribute("style","display:none;"),$("input").attr("disabled","disabled"),$("#classe").removeAttr("disabled"),$("textarea").attr("disabled","disabled"),revoirDs=!0,$.ajax({async:!1,url:site+API+"/php/isPropertie.php",data:"devoirID="+$("#devoirID").val()+"&userID="+userID+"&nom=correctionVisible&valeur=oui",dataType:"html",success:function(e){"oui"==e&&correction()}}),document.getElementById("noteDevoir").value=""+Math.round(note_globale/note_max*20*10)/10;var a=searchDataInDS();localStorage.setItem(userID+devoirID,a),$.ajax({async:!1,url:site+API+"/php/saveDS.php",type:"POST",data:a,dataType:"html",success:function(e){$("#aide").html(e),$("#aide").dialog({position:{my:"center center",at:"center center",of:window},width:500}),$("#aide").dialog("open"),e.match(/attention/i)||localStorage.clear()}})}function searchDataInDS(){for(var e="",t=document.getElementById("ds"),a=0;a<t.elements.length;a++){var o=t.elements[a];switch(o.tagName){case"INPUT":switch(o.type){case"hidden":case"text":e+=o.id+"="+encodeURIComponent(o.value)+"&";break;case"radio":case"checkbox":e+=o.id+"="+encodeURIComponent(o.checked)+"&"}break;case"SELECT":e+=o.id+"="+encodeURIComponent(o.value)+"&";break;case"TEXTAREA":""!=o.id&&(e+=o.id+"="+encodeURIComponent(o.value)+"&")}}return e=e.substring(0,e.length-1)}function getXMLHttpRequest(){var e=null;if(!window.XMLHttpRequest&&!window.ActiveXObject)return alert("Votre navigateur ne supporte pas l'objet XMLHTTPRequest..."),null;if(window.ActiveXObject)try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){e=new ActiveXObject("Microsoft.XMLHTTP")}else e=new XMLHttpRequest;return e}function initTimer(e,t,a){if(!timerOn){dateFin=new Date,dateFin.setHours(dateFin.getHours()+e),dateFin.setMinutes(dateFin.getMinutes()+t),dateFin.setSeconds(dateFin.getSeconds()+a);var o=document.getElementById("minute");10>t?o.textContent="0"+t:o.textContent=""+t,o=document.getElementById("seconde"),10>a?o.textContent="0"+a:o.textContent=""+a,runTimer=window.setInterval("timer()",1e3),timerOn=!0}}function timer(){if(now=new Date,reste=new Date(dateFin-now),now<dateFin){var e=document.getElementById("minute");reste.getMinutes()<10?e.textContent="0"+reste.getMinutes():e.textContent=reste.getMinutes(),e=document.getElementById("seconde"),reste.getSeconds()<10?e.textContent="0"+reste.getSeconds():e.textContent=reste.getSeconds()}else finTimer=!0,sendDS()}function debutDeTest(){if(modeEbauche){var e=Math.round(1e3*Math.random());return $("#nom").val("prof"+e),$("#prenom").val("prof"),$("#classe").val("3A"),setUserID(),statu="prof",!0}return debut_test?!0:""!=document.getElementById("nom").value&&""!=document.getElementById("prenom").value&&"..."!=document.getElementById("classe").value?(debut_test=!0,!0):!1}function afficheCommentaire(e){var t=document.getElementById(e);"SVGAnimatedString"==$(t).prop("className")?t.setAttribute("style","display:inline"):$(t).show()}function afficheNote(e,t){idObjSVG="Q"+e.charAt(1);var a=document.getElementById(e);"SVGAnimatedString"==$(a).prop("className")?(stringText=parseFloat(a.textContent),valeur_note=Math.round(10*(stringText+t))/10,a.textContent=valeur_note+""):(stringText=parseFloat($(a).text()),valeur_note=Math.round(10*(stringText+t))/10,$(a).text(valeur_note+""))}function afficheNoteDevoir(e,t,a){valeur_note=Math.round(10*a)/10,document.getElementById(t).setAttribute("style","display:inline"),document.getElementById(t).textContent=valeur_note+""}function afficheDate(){d=new Date,document.getElementById("date").value=d.getDate()+"-"+(d.getMonth()+1)+"-"+d.getFullYear()}function setColorEleveSelectionne(e){$("#prof").data("encourt",""+e),$(".element_liste_devoir").removeAttr("style"),$("#"+e).css("color","red")}function setPropertie(e,t,a,o){$.ajax({async:!1,url:site+API+"/php/setPropertie.php",data:"devoirID="+e+"&userID="+t+"&nom="+a+"&valeur="+o,dataType:"html",success:function(e){}})}function evaluateElementInText(){}function evaluateOrdreObjet(e,t,a,o,i,n,s){note_max+=o,afficheNote(n+"max",o);var r=[],l=[],d=[],c=[],u=[],p=[],m=0,f=$("#"+e).val().split(";");if(""!=f){for(var h=0;h<f.length;h++){var v=f[h].split(":");r[h]=v[0],v=v[1].split(","),tempdd=v[0].split("px"),c[h]=parseInt(tempdd[0]),tempdd=v[1].split("px"),p[h]=parseInt(tempdd[0])}var f=t.split(";");for(h=0;h<f.length;h++){var v=f[h].split(":");l[h]=v[0],v=v[1].split(","),tempdd=v[0].split("px"),d[h]=parseInt(tempdd[0]),tempdd=v[1].split("px"),u[h]=parseInt(tempdd[0])}for(var h=0;h<c.length;h++){for(var g=!0,b=0;b<d.length;b++)if(c[h]>d[b]-a&c[h]<d[b]+a&&p[h]>u[b]-a&p[h]<u[b]+a&&l[b]==r[h]){m+=i/d.length,$("#"+r[h]).removeClass("incorrect").addClass("correct"),g=!1,$("#"+r[h]).attr("title",i/d.length+" point");break}g&&($("#"+r[h]).addClass("incorrect").removeClass("correct"),"undefined"!=typeof s&&""!==s&&afficheCommentaire(s),$("#"+r[h]).attr("title","0 point"))}}afficheNote(n,m),note_globale+=m}function evaluatePositionObjet(e,t,a,o,i,n,s){note_max+=o,afficheNote(n+"max",o);var r=[],l=[],d=[],c=[],p=[],m=0,f=$("#"+e).val().split(";");if(""!=f){for(var h=0;h<f.length;h++){var v=f[h].split(":");r[h]=v[0],v=v[1].split(","),tempdd=v[0].split("px"),d[h]=parseInt(tempdd[0]),tempdd=v[1].split("px"),p[h]=parseInt(tempdd[0])}for(var f=t.split(";"),h=0;h<f.length;h++){var v=f[h].split(":");v=v[1].split(","),tempdd=v[0].split("px"),l[h]=parseInt(tempdd[0]),tempdd=v[1].split("px"),c[h]=parseInt(tempdd[0])}for(var h=0;h<d.length;h++){var g=!0;for(u=0;u<l.length;u++)if(d[h]>l[u]-a&d[h]<l[u]+a&&p[h]>c[u]-a&p[h]<c[u]+a){m+=i/l.length,$("#"+r[h]).removeClass("incorrect").addClass("correct"),g=!1;break}g&&($("#"+r[h]).addClass("incorrect").removeClass("correct"),"undefined"!=typeof s&&""!==s&&afficheCommentaire(s))}}afficheNote(n,m),note_globale+=m}function isChecked(e,t){var a=document.getElementById(e);return null!=a.getAttribute("checked")&&"true"==a.getAttribute("checked")}function reinitialise(){note_globale=0,note_max=0,$("[id*=noteq]").find("[id*=q]").text("0")}function evaluateDrop(e,t,a,o,i){note_max+=a;var n=0,s=t.split(","),r=Math.round(a/s.length*100)/100;afficheNote(o+"max",a);for(var l=0;l<s.length;l++){var d="("+s[l].replace(/\|/g,")|(")+")",c=new RegExp(d,"i");if(c.test($("#"+e).attr("depot"))){for(var u=_.compact([RegExp.$1,RegExp.$2,RegExp.$3,RegExp.$4,RegExp.$5,RegExp.$6,RegExp.$7,RegExp.$8,RegExp.$9]),p=0;l<u.length;l++)$("#"+u[p]).addClass("correct");afficheNote(o,r),note_globale+=r,n=!0,$("#"+u[0]).attr("title",r+"/"+r),n+=1}}for(var m=$("#"+e).attr("depot").split(";"),l=0;l<m.length;l++){var f=m[l].split(":");$("#"+f[0]).hasClass("correct")||($("#"+f[0]).addClass("incorrect").attr("title","0/"+r),"undefined"!=typeof i&&""!==i&&afficheCommentaire(i))}return n==s.length}function evaluateTagByExpReg(e,t,a,o,i,n){note_max+=a;var s=!1;return afficheNote(i+"max",a),t.test($("#"+e).attr("depot"))?($("#"+e).addClass("correct"),afficheNote(i,o),note_globale+=o,s=!0,$("#"+e).attr("title",o+"/"+a)):($("#"+e).addClass("incorrect"),"undefined"!=typeof n&&""!==n&&afficheCommentaire(n),$("#"+e).attr("title","0/"+a)),$("#"+e).prop("disabled",!0),s}function evaluateExpReg(e,t,a,o,i,n){note_max+=a;var s=!1;if(afficheNote(i+"max",a),t.test(document.getElementById(e).value)){var r=$("#"+e).parent().attr("title").split("/");if(o==r[1]&&(a=r[1]),0==a){if($("#"+e).removeClass("correct incorrect").addClass("partiel"),""!=n){var l='<img style="position: relative; top: -10px; left: 5px;float:right;" class="" src="https://coursdesciences.fr/devoir/API4/corrige16.png" alt="" titre="'+n+'" height="16" width="16">';$("#"+e).parent().prepend(l)}$("#"+e).parent().attr("title","résultat obtenu à la réponse "+o+"/"+r[1])}else $("#"+e).removeClass("incorrect partiel").addClass("correct"),$("#"+e).parent().attr("title","résultat obtenu à la réponse "+o+"/"+a);afficheNote(i,o),note_globale+=o,s=!0}else $("#"+e).removeClass("correct partiel").addClass("incorrect"),"undefined"!=typeof n&&""!==n&&afficheCommentaire(n),$("#"+e).parent().attr("title","résultat obtenu à la réponse 0/"+a);return document.getElementById(e).disabled=!0,console.log(e+"----------------------------------expReg"),console.log("note_max : "+note_max),console.log("note_globale : "+note_globale),console.log("----"),s}function evaluateCheckBox(e,t,a,o,i,n,s){var r=!1;o="undefined"!=typeof o?o:1;var l=0,d=0;$("[groupe="+t+"]").each(function(){d+=""==$(this).attr("note")?0:parseFloat($(this).attr("note")),l+=""==$(this).attr("penalite")?0:parseFloat($(this).attr("penalite"))});var c=e.substring(4);if(document.getElementById(e).checked){if("nc"==a){note_max+=o,afficheNote(n+"max",o),$("#"+e).next().addClass("incorrect"),$("#boite"+c).attr("note",0).attr("penalite",i);var u=0;0>d-l||(u=d-l-i>0?0-i:l-d),note_globale+=u,afficheNote(n,u),"undefined"!=typeof s&&""!==s&&afficheCommentaire(s),$("#"+e+" ~ label").attr("title","-"+i)}if("c"==a){note_max+=o,afficheNote(n+"max",o),$("#"+e).next().addClass("correct"),$("#boite"+c).attr("note",o).attr("penalite","0");var u=0;d-l>0?u+=o:o+d-l>0&&(u+=o+d-l),note_globale+=u,afficheNote(n,u),$("#"+e+" ~ label").attr("title",o+"/"+o),r=!0}}else{if("c"==a){$("#"+e).next().addClass("attendu"),note_max+=o,afficheNote(n+"max",o),$("#"+e).next().addClass("incorrect"),$("#boite"+c).attr("note",0).attr("penalite",i);var u=0;0>d-l||(u=d-l-i>0?0-i:l-d),note_globale+=u,afficheNote(n,u),"undefined"!=typeof s&&""!==s&&afficheCommentaire(s),$("#"+e+" ~ label").attr("title","-"+i)}if("nc"==a){note_max+=o,afficheNote(n+"max",o),$("#"+e).next().addClass("correct"),$("#boite"+c).attr("note",o).attr("penalite","0");var u=0;d-l>0?u+=o:o+d-l>0&&(u+=o+d-l),note_globale+=u,afficheNote(n,u),$("#"+e+" ~ label").attr("title",o+"/"+o),r=!0}}return document.getElementById(e).disabled=!0,r}function evaluateExpNum(e,t,a,o,i,n){return retour=!1,note_max+=o,afficheNote(i+"max",o),reponseEleve=parseFloat(document.getElementById(e).value),resultatMax=t+a,resultatMin=t-a,reponseEleve>=resultatMin&&reponseEleve<=resultatMax?($("#"+e).addClass("correct"),afficheNote(i,o),note_globale+=o,retour=!0,$("#"+e).attr("title",o+"/"+o)):($("#"+e).addClass("incorrect"),"undefined"!=typeof n&&""!==n&&afficheCommentaire(n),$("#"+e).attr("title","0/"+o)),document.getElementById(e).disabled=!0,retour}function evaluateRatioButton(e,t,a,o,i,n){if(a="undefined"!=typeof a?a:1,document.getElementById(e).checked){if("nc"==t){note_max+=a,note_globale+=o,afficheNote(i+"max",a),afficheNote(i,o);var s=document.getElementById(e).nextSibling;s.setAttribute("class","incorrect"),"undefined"!=typeof n&&""!==n&&afficheCommentaire(n),$("#"+e+" ~ label").attr("title",o+"/"+a)}if("c"==t){note_max+=a,note_globale+=o;var s=document.getElementById(e).nextSibling;s.setAttribute("class","correct"),afficheNote(i+"max",a),afficheNote(i,o),$("#"+e+" ~ label").attr("title",o+"/"+a)}}else if("c"==t){document.getElementById(e).fill="green",note_max+=a;var s=document.getElementById(e).nextSibling;s.setAttribute("class","attendu"),afficheNote(i+"max",a),"undefined"!=typeof n&&""!==n&&afficheCommentaire(n),$("#"+e+" ~ label").attr("title","0/"+a)}document.getElementById(e).disabled=!0}function eventEvaluateManuel(e){if("prof"==statu){var t=e.target.checked?"true":"false",a=e.target.id;$.ajax({async:!1,url:site+API+"/prof/evaluateManuel.php",data:"devoirID="+$("#devoirID").val()+"&userID="+$("#userID").val()+"&element="+a+"&valeur="+t,dataType:"html",success:function(e){recorrection($("#userID").val(),$("#devoirID").val())}})}}function evaluateManuel(e,t,a,o,i){var n=$("[id*="+t+"]:checked");if(0!=n.length){var s=n[0].id,r=("e".charCodeAt(0),25*("e".charCodeAt(0)-s.charCodeAt(s.length-1)));note_max+=a,note_globale+=a*r/100,afficheNote(o+"max",a),afficheNote(o,a*r/100),100>r?($("#"+e).addClass("incorrect"),"undefined"!=typeof i&&""!==i&&afficheCommentaire(i)):$("#"+e).addClass("correct"),$("#"+e).attr("title",a*r/100+"/"+a)}}function evaluateManuelUnique(e,t,a,o,i){var n=$("#"+t+":checked").length>0;note_max+=a,afficheNote(o+"max",a),n?(note_globale+=a,afficheNote(o,a),$("#"+e).attr("class","correct").attr("title",a+"/"+a)):($("#"+e).attr("class","incorrect").attr("title","0/"+a),"undefined"!=typeof i&&""!==i&&afficheCommentaire(i))}function evaluateTexteTrous(e,t,a){var o=0,i=0;$(""+e).each(function(e){o=e,$(this).attr("attendu")==$(this).attr("depot")?(i+=1,$(this).addClass("correct")):$(this).addClass("incorrect")}),note_globale+=t*i/o,note_max+=t,afficheNote(a,t*i/o),afficheNote(a+"max",t)}function evaluateCloze(e,t){var a=e.correction();a=a.split("/"),note_globale+=parseFloat(a[0]),note_max+=parseFloat(a[1]),afficheNote(t,a[0]),afficheNote(t+"max",a[1])}function alreadyResponse(e,t){var a=null;a&&0!=a.readyState&&a.abort(),a=getXMLHttpRequest(),a.open("POST",site+API+"/php/isResponse.php",t),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onload=function(){initDevoir(a.responseText)},a.send(e)}function ajax_load_svg(){$(".loadSVG").each(function(e){var t=$(this).attr("nomFichier"),a=$(this).parent().attr("id");$.ajax({async:!1,url:site+API+"/php/loadSVG.php",data:"fichier="+t,dataType:"xml",success:function(e){""!=e&&$("#"+a).html(document.adoptNode($("svg",e)[0]))}})})}function ajax_loader(e,t){$.ajax({async:!1,url:site+API+"/php/loadSVG.php",data:"fichier="+e,dataType:"xml",success:function(e){""!=e&&$("#"+t).html(document.adoptNode($("svg",e)[0]))}})}function ajax_loader_question(){$.ajax({async:!1,url:site+API+"/php/loadQuestion.php",data:"fichier="+chemin+"questions.html",dataType:"html",success:function(e){""!=e&&(dvQuestions=e,$("#questions").html(e))}})}function init(){$(document).tooltip({items:"[titre],[title]",content:function(e){return $(this).is("[titre]")?$(this).attr("titre"):$(this).attr("title")}}),nbQuestion=$(".question").length-1;for(var e=0;nbQuestion+1>e;e++)pages[e]=e;switch(setVariables(),init_nav_bar(nbQuestion),$(".question").on("click",function(e){$(this).find(".dvFocused").removeClass("dvFocused")}),$(".question").on("click",".dvScience",function(e){e.stopPropagation()}),statu){case"eleve":$('[id*="manuel"]').attr("disabled","disabled"),debutDeTest()&&alreadyResponse(dv_data(),!1);break;case"prof":initDevoir("false"),$('[id*="manuel"]').removeAttr("disabled")}}function initOrderQuestions(e){for(var t,a=1;nbQuestion+1>a;a++)n=parseInt(Math.random()*(nbQuestion-a))+1,t=e[n],e[n]=e[nbQuestion+1-a],e[nbQuestion+1-a]=t;return e}function init_nav_bar(e){for(var t="",a=1;e+1>a;a++)t='<span class="bouton" id="bouton'+a+'"> </span>',$(t).appendTo($("#menu"));$("#menu").on("click","[id*=bouton]",function(e){if(e.ctrlKey&&dv.modeEbauche){var t=$(this).attr("id").substring(6);0!=t&&(dv.defaire=$("#question"+t),$("#question"+t).remove(),$("#questions [id*=question]").each(function(e){$(this).attr("id","question"+e)}),$("#menu").children(":last").remove()),afficheQuestion(t-1)}else afficheQuestion($(this).attr("id").substring(6))}),$("#questions [id*=question]").hide(),$("#question0").show()}function afficheQuestion(e){if(debutDeTest()||dv.modeEbauche){if(dv.EleveCompose){var t=searchDataInDS();localStorage.setItem(userID+devoirID,t)}timerOn||revoirDs||dv.modeEbauche||(modeEbauche||initTimer(0,minute,seconde),$.ajax({async:!1,url:site+API+"/php/setPropertie.php",data:"devoirID="+$("devoirID").val()+"&userID="+$("userID").val()+"&nom=modifiable&valeur=oui",dataType:"html",success:function(e){}})),pageActuelle=e;for(var a=$(".question").length,o=0;a>o;o++)o==e?(document.getElementById("bouton"+o).style.backgroundPosition="-60px 0px",document.getElementById("question"+pages[o]).style.display="block",dv.modeEbauche&&($("#page").off(),$("#page [id*=boite][class*=construction]").off("click dblclick mousedown"),$("#page [id*=boite][class*=resizable]").filter(".ui-resizable").resizable("destroy"),$("#page [id*=boite][class*=resizable]").removeClass("ui-resizable-autohide"),$("#page [id*=boite][class*=draggable]").draggable("destroy"),$("#page [id*=boite][class*=droppable]").droppable("destroy"),$("#page [id*=boite][class*=construction]").removeClass("construction"),$("#page [id*=drag]").each(function(){$.proxy(maPage.delInteractivite("#"+this.id),maPage)})),$("#page").removeAttr("id"),$("#question"+pages[e]+" .page").attr("id","page"),dv.modeEbauche&&(maPage.firstParent="question"+e,$("#page").droppable({hoverClass:"hoverDroppable",tolerance:"fit",greedy:!0,addClass:!1,drop:$.proxy(function(e,t){e.stopPropagation(),this.selection.addObjet(t.draggable[0]);for(var a=0;a<this.selection.objets.length;a++){var o=$(this.selection.objets[a]),i=$(e.target),n=i.offset(),s=o.offset(),r={};for(var l in n)r[l]=s[l]-n[l];o.css(r),i.append(o[0])}},maPage)}).on("mousedown",$.proxy(function(e){e.ctrlKey||(this.selection.objets=[],$("#deselected").click()),$(".ghost-select").remove(),$("#page").append('<div style="width: 0px; height: 0px;" class="ghost-select"><span></span></div>'),$(".ghost-select").css({left:e.pageX-40,top:e.pageY-200,width:0,height:0}),this.selecteur.initialX=e.pageX,this.selecteur.initialY=e.pageY,$("#page").off("mouseup mousemove").on("mouseup",null,{objCreatePage:this},$.proxy(this.selecteur.selectElements,this.selecteur)).on("mousemove",$.proxy(this.selecteur.openSelector,this.selecteur))},maPage)).on("click",function(e){dv.noDeselected?dv.noDeselected=!1:(maPage.selection.objets=[],$("#deselected").click()),$("#questions").focus()}),$.proxy(maPage.setInteractivite("#page [id*=boite]"),maPage),$("#page [id*=boite]").addClass("construction"),$("#page [id*=drag]").each(function(){$.proxy(maPage.setInteractivite("#"+this.id),maPage)})),$("#page").on("click",function(e){$("#page .dvScience").trigger("lostFocus")}),$("#page .dvScience").trigger("refresh")):($("#bouton"+o).removeAttr("style"),document.getElementById("question"+pages[o]).style.display="none"),0==e?(document.getElementById("entete").style.display="block",document.getElementById("entete2").style.display="none"):(document.getElementById("entete2").style.display="block",document.getElementById("entete").style.display="none");dv.modeEbauche&&maPage.selection.removeAll()}else window.alert("Vous devez indiquer votre NOM, PRENOM et votre CLASSE !")}function setDragDrop(e,t){var a="";if(a=e.split(";"),""!=a[0])for(var o=0;o<a.length;o++){var i=a[o].split(":"),n=i[1].split(","),s={top:n[1],left:n[0]};$("#"+i[0]).css(s)}}function dragStop(e,t,a){for(var o=t.helper[0].id,i=o+":"+$(t.helper[0]).css("left")+","+$(t.helper[0]).css("top"),n=$("#"+a).val().split(";"),s="",r=!1,l=0;l<n.length;l++){""==n[0]&&(s=i,r=!0);var d=n[l].split(":");d[0]==o?(r=!0,0!=l&&(s+=";"),s+=i):(0!=l&&(s+=";"),s+=n[l])}r||(s=s+";"+i);for(var c=s.split(";"),u=[],l=0;l<c.length;l++){var p;p=c[l].split(":"),p=p[1].split(","),p=p[0],p=p.split("px"),u[l]=parseInt(p[0])}for(var m=1;m<c.length;m++){for(var f=m,h=m+1;h<c.length;h++)u[h]<u[f]&&(f=h);if(u[f]<u[m-1]){var p=u[m-1];u[m-1]=u[f],u[f]=p,p=c[m-1],c[m-1]=c[f],c[f]=p}}s=c[0];for(var m=1;m<c.length;m++)s=s+";"+c[m];$("#"+a).val(s)}function initDevoir(e){if("false"!=e)$("input:radio").prop("checked",!1),$("input:checkbox").prop("checked",!1),$('[id*="commentaire"]').css("display","none"),document.getElementById("nom").disabled=!0,document.getElementById("prenom").disabled=!0,document.getElementById("classe").disabled=!0,document.getElementById("date").disabled=!0,$.ajax({async:!1,url:site+API+"/php/isPropertie.php",data:"devoirID="+$("#devoirID").val()+"&userID="+userID+"&nom=modifiable&valeur=oui",dataType:"html",success:function(t){if(devoirModifiable="oui"==t,"non"==t||"prof"==statu){document.getElementById("correction").setAttribute("style","display:none;"),setResponse(e),"function"==typeof extra&&extra();var a=document.getElementById("minute");a.textContent=$("#resteMinute").val(),a=document.getElementById("seconde"),a.textContent=$("#resteSeconde").val();for(var o=$('[id*="move"]'),i=0;i<o.length;i++)setDragDrop(o[i].value,!0);$.ajax({async:!1,url:site+API+"/php/isPropertie.php",data:"devoirID="+$("#devoirID").val()+"&userID="+userID+"&nom=correctionVisible&valeur=oui",dataType:"html",success:function(e){if("oui"==e||"prof"==statu)revoirDs=!0,$("[class*='correct']").removeClass("correct"),$("[class*='incorrect']").removeClass("incorrect"),"prof"==statu?$('[id*="evalProf"]').css("display","block"):($('[id*="evalProf"]').css("display","none"),$('[id*="manuel"]').attr("disabled","disabled")),correction();else{$("input").attr("disabled","disabled"),$("textarea").attr("disabled","disabled"),$('[id*="evalProf"]').css("display","none");for(var t=$('[id*="move"]'),a=0;a<t.length;a++)setDragDrop(t[a].value,!1)}}}),revoirDs=!0}else{revoirDs=!1,dv.EleveCompose=!0;var n=localStorage.getItem(userID+devoirID);setResponse(n?n:e),"function"==typeof extra&&extra();for(var o=$('[id*="move"]'),i=0;i<o.length;i++)setDragDrop(o[i].value,!1);$(".commentaire").css("display","none"),$('[id*="evalProf"]').css("display","none"),initTimer(0,1*$("#resteMinute").val(),1*$("#resteSeconde").val())}"prof"==statu&&$('[id*="manuel"]').removeAttr("disabled")}});else{afficheDate(),revoirDs=!1,$(".commentaire").css("display","none"),orderQuestions&&(pages=initOrderQuestions(pages));var t=setIdentite();if(t?(document.getElementById("nom").disabled=!0,document.getElementById("prenom").disabled=!0):($("#nom").removeAttr("disabled"),$("#prenom").removeAttr("disabled")),$.ajax({async:!1,url:site+API+"/php/setPropertie.php",data:"devoirID="+$("#devoirID").val()+"&userID="+$("#userID").val()+"&nom=modifiable&valeur="+(devoirModifiable?"oui":"non"),dataType:"html",success:function(e){}}),$.ajax({async:!1,url:site+API+"/php/setPropertie.php",data:"devoirID="+$("#devoirID").val()+"&userID="+$("#userID").val()+"&nom=correctionVisible&valeur="+(premiereEssaiCorrectionVisible?"oui":"non"),dataType:"html",success:function(e){}}),$('[id*="evalProf"]').css("display","none"),"prof"==statu)"function"==typeof premiereEssai&&premiereEssai(),setUIProf(),$("#nom").removeAttr("disabled"),$("#prenom").removeAttr("disabled");else{dv.EleveCompose=!0;var a=localStorage.getItem(userID+devoirID);a&&setResponse(a);var o="non";premiereEssaiCorrectionVisible&&(o="oui"),$.ajax({async:!1,url:site+API+"/php/setPropertie.php",data:"devoirID="+$("#devoirID").val()+"&userID="+$("#userID").val()+"&nom=correctionVisible&valeur="+o,dataType:"html",success:function(e){}}),"function"==typeof premiereEssai&&premiereEssai()}}$("#loader").css("display","none"),$(".dvScience").trigger("change")}function setUIProf(){$.ajax({async:!1,url:site+API+"/php/loadQuestion.php",data:"fichier=../prof/outilsProf.html",dataType:"html",success:function(e){$("#outilsProf").html(e)}}),$.ajax({async:!1,url:site+API+"/php/loadQuestion.php",data:"fichier=../prof/UIprof.html",dataType:"html",success:function(e){var t=/\<body\>([\s\S]*?)\<\/body\>/i;t.exec(e);var a=RegExp.$1;$(""+a).appendTo($("#prof"))}}),maPage.init("question0"),$.ajax({async:!1,url:site+API+"/php/loadQuestion.php",data:"fichier=../prof/parametre.html",dataType:"html",success:function(e){var t=/\<body.*\>([\s\S]*?)\<\/body\>/i;t.exec(e);var a=RegExp.$1;$(""+a).appendTo($("#menuParametre"))}}),$("#menuProf").tabs({activate:function(event,ui){var newMenu=ui.newPanel.attr("id"),oldMenu=ui.oldPanel.attr("id");"menuEbauche"!=newMenu&&"menuCorrection"!=newMenu&&"menuParametre"!=newMenu||dv.modeEbauche||(dv.modeEbauche=!0,$("#questions").html(dvQuestions),$("#questions").on("mouseenter",function(){this.focus()}).on("mouseleave",function(){this.blur()}).on("keyup",$.proxy(function(e){e.stopPropagation();var t=!1,a=!1,o=!1,i=!1;if(e.ctrlKey)switch(e.keyCode){case 67:t=!0,this.copy=$(this.selection.objets).clone(),console.log("CTRL + C"),this.selection.removeAll();break;case 88:i=!0,this.copy=$(this.selection.objets).clone();for(var n=0;n<this.selection.objets.length;n++)$(this.selection.objets[n]).remove();this.selection.removeAll(),console.log("CTRL + X");break;case 86:a=!0;for(var s="page",r=$(this.copy).clone(),n=0;n<$(this.copy).length;n++){var l=this.index,d=$(r[n]).attr("id").substring(5);$(r[n]).attr("id","boite"+this.index),this.index++;var c=$(r[n]).attr("title");if(void 0!=c){var u=$(r[n]).html();c=c.replace(d,l);var p=new RegExp(""+d,"g");u=u.replace(p,l),$(r[n]).html(u).attr("title",c)}for(var m=$(r[n]).find("[id*=boite]"),f=0;f<m.length;f++){var h=this.index,v=$(m[f]).attr("id").substring(5);$(m[f]).attr("id","boite"+this.index),this.index++;var c=$(m[f]).attr("title");if(void 0!=c){var u=$(m[f]).html();c=c.replace(v,h);var p=new RegExp(""+v,"g");u=u.replace(p,h),$(m[f]).html(u).attr("title",c)}}$(r[n]).appendTo("#"+s),this.setInteractivite("#boite"+l);for(var g=$("#boite"+l+" [id*=boite]"),b=0;b<g.length;b++)this.setInteractivite("#"+$(g[b]).attr("id"))}this.selection.removeAll(),console.log("CTRL + V");break;case 65:o=!0,console.log("CTRL + A")}},maPage)),$("#outils").show("slide",{direction:"up"},700),$("#outilsLeft").show("slide",{direction:"right"},700),$("#devoir").css("height","700px"),$("#menuProf").css("height","670px"),$("#question"+pageActuelle+" .page").attr("id","page"),$("#page").droppable({hoverClass:"hoverDroppable",tolerance:"fit",greedy:!0,addClass:!1,drop:$.proxy(function(e,t){e.stopPropagation(),this.selection.addObjet(t.draggable[0]);for(var a=0;a<this.selection.objets.length;a++){var o=$(this.selection.objets[a]),i=$(e.target),n=i.offset(),s=o.offset(),r={};for(var l in n)r[l]=s[l]-n[l];o.css(r),i.append(o[0])}},maPage)}).on("mousedown",$.proxy(function(e){e.ctrlKey||(this.selection.objets=[],$("#deselected").click()),$(".ghost-select").remove(),$("#page").append('<div style="width: 0px; height: 0px;" class="ghost-select"><span></span></div>'),$(".ghost-select").css({left:e.pageX-40,top:e.pageY-200,width:0,height:0}),this.selecteur.initialX=e.pageX,this.selecteur.initialY=e.pageY,$("#page").off("mouseup mousemove").on("mouseup",null,{objCreatePage:this},$.proxy(this.selecteur.selectElements,this.selecteur)).on("mousemove",$.proxy(this.selecteur.openSelector,this.selecteur))},maPage)).on("click",function(e){dv.noDeselected?dv.noDeselected=!1:$("#deselected").click(),$("#questions").focus()}),$("[aria-describedby*=boite]").each(function(){$(this).remove()}),$("script.ebauche").each(function(i){eval($(this).text())}),$.proxy(maPage.setInteractivite("#page [id*=boite]"),maPage),$("#page [id*=drag][class*=draggable]").draggable("destroy"),$("#page [id*=drag]").each(function(e){var t=this.id;$("#"+t).css("left","0px").css("top","0px"),$("[depot]").attr("depot",""),$.proxy(maPage.setInteractivite("#"+t),maPage)}),$("#page [id*=boite]").addClass("construction"),$(".noteExercice,[id*=evalProf],.commentaire").show(),$("input, textarea").removeAttr("disabled"),afficheQuestion(pageActuelle)),"menuEbauche"!=oldMenu&&"menuCorrection"!=oldMenu&&"menuParametre"!=oldMenu||"menuSuivi"!=newMenu||(dv.modeEbauche=!1,dv.correctionOn=!1,$("#correction").show(),$("#questions").off(),$("#page").off(),$("#page [id*=boite][class*=construction]").off("click dblclick mousedown"),$("#page [id*=boite][class*=resizable]").filter(".ui-resizable").resizable("destroy"),$("#page [id*=boite][class*=resizable]").removeClass("ui-resizable-autohide"),$("#page [id*=boite][class*=draggable]").draggable("destroy"),$("#page [id*=boite][class*=droppable]").droppable("destroy"),$("#page [id*=boite][class*=construction]").removeClass("construction"),$("#page [id*=drag]").each(function(){$.proxy(maPage.delInteractivite(this.id),maPage),$(this).removeClass("construction")}),$("#page").removeClass("hoverDroppable"),$("#page").removeAttr("id"),maPage.selection.removeAll(),$(".commentaire").hide(),$(".question").hide(),$(".dvFocused").removeClass("dvFocused"),$("parametre").text(paramText),$("#question0").show(),dvQuestions=$("#questions").html(),$("#questions").html(dvQuestions),$("#question0").hide(),$("#outils").hide("slide",{direction:"up"},700),$("#outilsLeft").hide("slide",{direction:"right"},700),$("#menuProf").css("height","640px"),$("#devoir").css("height","670px"),$(".dvDialog").each(function(){eval($(this).text())}),$("script.interactivite").each(function(){eval($(this).text())}),afficheQuestion(pageActuelle),$(".commentaire").hide()),$("#page .dvScience").trigger("change")}});var devoirID=document.getElementById("devoirID").value;$.ajax({async:!1,url:site+API+"/prof/find_classes.php",data:"devoirID="+devoirID,method:"GET",dataType:"html",success:function(e){$(""+e).appendTo($("#profClasse"))}}),$("#prof").show(),$.ajax({async:!1,url:site+API+"/prof/find_devoirs.php",data:"devoirID="+devoirID+"&classe="+$("#profClasse option:selected").val(),method:"GET",dataType:"html",success:function(e){$(""+e).appendTo($("#prof_liste_classe")),$("#moyenneClasse").text($("#moyenne").val())}}),$(".btn4AllCorrige").click(function(){$(".corrige").click()}),$(".btn4AllModifableOui").click(function(){setPropertieForAll("btnModifiable","modifiable","oui")}),$(".btn4AllModifableNon").click(function(){setPropertieForAll("btnModifiable","modifiable","non")}),$(".btn4AllVuOn").click(function(){setPropertieForAll("btnVu","correctionVisible","oui")}),$(".btn4AllVuOff").click(function(){setPropertieForAll("btnVu","correctionVisible","non")}),$("question0 .page").attr("id","page"),dv.modeEbauche=!1,$("#loader").hide()}function setResponse(e){var t=e.split("&");$("[id*=drag]").css("left","0px").css("top","0px");for(var a=0;a<t.length;a++){var o=[];str=t[a].split("="),o.push(str.shift()),o.push(str.join("=")),"true"!=o[1]&&"false"!=!o[1]?(document.getElementById(o[0]).value=decodeURIComponent(o[1]),$("#questions #"+o[0]).not("[id*=manuel]").trigger("change")):"true"==o[1]?document.getElementById(o[0]).checked=!0:document.getElementById(o[0]).checked=!1}var i=revoirDs;revoirDs=!0,$("[id*=drop]").trigger("change"),revoirDs=i}function extra(){$(".commentaire").css("display","none")}function rotation(e){var t=e.target.id,a=parseInt($("#"+t).data("angle"));a+=90,a%=360,$("#"+t).data("angle",""+a).css("transform","rotate("+a+"deg)")}function premiereEssai(){}function renew(){}function textSelected(e){$(e.target).parent().find(".textSelected").removeClass("textSelected"),$(e.target).addClass("textSelected"),$("#Text"+$(e.target).parent().parent().attr("id").substring(5)).val($(e.target).text())}function beforeSave(){$(".savable").trigger("save")}function correction(){reinitialise(),$("code").each(function(){void 0===$(this).attr("disable")&&eval($(this).text())}),$("code[disable]").removeAttr("disable"),afficheNoteDevoir("entete_devoir","note_devoir",note_globale/note_max*20),dv.correctionOn=!0}function setClasseHtml(){var e='<option selected="selected" value="...">...</option><option value="'+typeClasse+'A" >'+typeClasse+'A</option><option value="'+typeClasse+'B">'+typeClasse+'B</option><option value="'+typeClasse+'C">'+typeClasse+'C</option><option value="'+typeClasse+'D">'+typeClasse+'D</option><option value="'+typeClasse+'E">'+typeClasse+'E</option><option value="'+typeClasse+'F">'+typeClasse+"F</option>";$("#classe").html(e)}function hiding(e){e.substring(5);if(dv.EleveCompose||!dv.modeEbauche&&!dv.correctionOn){var t=$("#"+e).children("[id*=boite][hiding!=no]"),a=parseInt($("#"+e).attr("hiding")),o=_.sampleSize(t,t.length-a),i="";$(o).each(function(e){$(this).hide().attr("hiding","yes"),0!=e&&(i+=";"),i+=$(this).attr("id")}),$("#"+e).find("[id*=mask]").val(i).trigger("change")}}function order(e){if(dv.EleveCompose||!dv.modeEbauche&&!dv.correctionOn){var t=$("#"+e).children("[id*=boite]"),a=_.shuffle(t);$(t).remove(),$("#"+e).prepend(a)}}function dvOnreload(e){dv.modeEbauche||$("#"+e).find("[id*=mask]").on("change",function(a){$("#"+e).children("[id*=boite]").show();var o=$(this).val().split(";");for(t=0;t<o.length;t++)$("#"+o[t]).hide().find("code").attr("disable","disable");
})}var note_globale=0,note_intermediaire=0,note_max=0,debut_test=!1,xhr=null,timerOn=!1,finTimer=!1,dateFin=new Date,revoirDs=!1,devoirModifiable=!1,statu="eleve",pages=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20],pageActuelle=0,question_cloze=[],nbQuestion=0,dvQuestions,modeEbauche=!1,dv={modeEbauche:!1,enteteHtml:'<!DOCTYPE html><html><head><meta content="text/html; charset=utf-8" http-equiv="content-type"><title>question de type cloze</title><script src="../../API4/jquery.min.js"></script><link rel="stylesheet" href="../../API4/jquery-ui.css"><script src="../../API4/jquery-ui.min.js"></script><link href="../../API4/defaut.css" rel="stylesheet" type="text/css" /><link href="temp.css" rel="stylesheet" type="text/css" /><script src="TypeExo.js"></script><style type="text/css">div { padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;}.page {position:absolute;}</style></head><body><div id="Q1" style="float: right;padding: 20px;"></div><div class="page choices-border questionid">',piedHtml:"</div></body></html>",EleveCompose:!1};if("undefined"==typeof orderQuestions)var orderQuestions=!1;$(function(){ajax_loader_question(),ajax_load_svg(),setClasseHtml(),$(".commentaire").css("display","none"),init(),$("#correction").on("mouseenter",function(e){$(this).attr("width","70").attr("height","130")}),$("#correction").on("mouseleave",function(e){$(this).attr("width","60").attr("height","110")})});